<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>

    <script>
        window.onload = () => {
            navigator.geolocation.getCurrentPosition((position) => {
                //document.querySelector("a-entity").setAttribute("gps-entity-place", "latitude: 40.68741743907926; longitude: -73.95971446133602");

                //log the current position 
                console.log("Lat: " + position.coords.latitude.toString() + "  Long: " + position.coords.longitude.toString());
            });
        }
    </script>
    <script>
        //gps camera events logging
        AFRAME.registerComponent('camerapositionhandler', {
            init: function () {

                console.log("Aframe component registration")

                //place added
                window.addEventListener('gps-camera-origin-coord-set', () => {
                    //this fired on mobile!  first one to trigger
                    console.log("gps-camera-origin-coord-set");

                    //print the camera position
                    var camearLocation = document.querySelector("a-camera").getAttribute("position")
                    console.log(camearLocation.x);

                    //add our a-entity here?
                    //document.querySelector("a-entity").setAttribute("gps-entity-place", "latitude: 40.68741743907926; longitude: -73.95971446133602");
                });

                //place added
                window.addEventListener('gps-entity-place-added', (details) => {
                    console.log("gps-entity-place-added", details);
                });

                //place update position
                window.addEventListener('gps-entity-place-update-positon', (details) => {
                    console.log("gps-entity-place-update-positon", details);
                });

                //camera update position
                window.addEventListener('gps-camera-update-positon', (details) => {
                    console.log("gps-camera-update-positon", details.position);
                    //print the camera position
                    var camearLocation = document.querySelector("a-camera").getAttribute("position").toString()
                    console.log(camearLocation.x);
                });
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene 
        
        vr-mode-ui="enabled: false" 
        embedded
        loading-screen="enabled: false;" 
        arjs="sourceType: webcam; debugUIEnabled: false;">
        

        <a-assets>
            <a-asset-item id="animated-asset" src="assets/asset.glb"></a-asset-item>
        </a-assets>

        <a-entity 
            gps-entity-place="latitude: 40.68741743907926; longitude: -73.95971446133602"
            gltf-model="#animated-asset">
        </a-entity>
        <!--a-entity 
            animation-mixer="loop: repeat" 
            gltf-model="#animated-asset" 
            scale="0.25 0.25 0.25"
            position="0 0 0"
            look-at="[gps-camera]" 
            gps-entity-place="latitude: 40.68741743907926; longitude: -73.95971446133602">
        </a-entity-->
        <a-camera gps-camera rotation-reader></a-camera>
        <a-entity camerapositionhandler></a-entity> 


    </a-scene>
</body>

</html>